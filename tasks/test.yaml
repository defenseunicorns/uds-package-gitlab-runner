tasks:
  - name: glr-health-check
    description: Check the status of Gitlab Runner
    actions:
      - description: Check Gitlab Runner Secret
        wait:
          cluster:
            kind: Secret
            name: gitlab-gitlab-runner-secret
            namespace: gitlab-runner
      - description: Check Gitlab Runner Deployment
        wait:
          cluster:
            kind: Deployment
            name: gitlab-runner
            namespace: gitlab-runner
            condition: Available
      - description: Check GitLab Runner Logs for Successful Registration
        dir: test
        cmd: npm test -- journey/registration.test.ts

  - name: glr-run-check
    description: Check that a GitLab repository can trigger a gitlab runner to run
    actions:
      - description: Setup a repository and trigger a pipeline job
        dir: test
        cmd: npm test -- journey/pipeline-run.test.ts
